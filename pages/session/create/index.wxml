<!-- pages/session/create/index.wxml -->
<!-- 创建牌局页面 -->
<view class="container">
  <!-- 参与者及台版开关 -->
  <view class="participants-bar">
    <view class="label">参与者</view>
    <view class="switch-wrapper">
      <text class="switch-label">台板</text>
      <switch checked="{{taiSwitch}}" bindchange="onTaiSwitchChange"></switch>
    </view>
  </view>
  
  <!-- 参与者头像列表 -->
  <scroll-view scroll-x="true" class="avatar-list">
    <view class="avatar-list-inner">
      <block wx:for="{{participants}}" wx:key="index">
        <view class="avatar-item">
          <image class="avatar" src="/assets/avatar-placeholder.png"></image>
          <text class="avatar-name">{{item.name}}</text>
        </view>
      </block>
      <view class="avatar-item plus" bindtap="showAddModal">
        <image class="plus-icon" src="/assets/plus.png"></image>
      </view>
    </view>
  </scroll-view>
  
  <!-- 二维码区域 -->
  <view class="qr-section">
    <!-- 二维码显示 -->
    <view class="qr-container">
      <image wx:if="{{qrCodeUrl && !qrGenerating}}" class="qr-image" src="{{qrCodeUrl}}" mode="aspectFit"></image>
      <view wx:else class="qr-placeholder">
        <image class="placeholder-img" src="/assets/qr-placeholder.png"></image>
        <text class="placeholder-text">{{qrError || '二维码生成中...'}}</text>
      </view>
    </view>
    
    <!-- 二维码操作 -->
    <view class="qr-actions">
      <text class="qr-text">微信扫一扫二维码加入牌局</text>
      <view class="qr-buttons">
        <button size="mini" class="refresh-btn" bindtap="refreshQRCode" disabled="{{qrGenerating}}">
          {{qrGenerating ? '生成中...' : '刷新'}}
        </button>
        <!-- 仅当可分享时渲染按钮；不再使用 disabled -->
        <button wx:if="{{canShare}}"
                id="shareBtn"
                class="share-btn"
                open-type="share">分享邀请</button>
        <!-- 不可点时用 view 占位，防止布局跳动 -->
        <view wx:else class="share-btn share-btn--disabled">分享邀请</view>
      </view>
    </view>
    
    <!-- 邀请码模块 -->
    <view class="invite-code-section">
      <text class="code-label">邀请码：</text>
      <text class="invite-code">{{inviteCode || '生成中...'}}</text>
      <button size="mini" class="copy-btn" bindtap="copyInviteCode" disabled="{{!inviteCode}}">复制</button>
    </view>
  </view>
  
  <!-- 开始记分按钮 -->
  <view class="start-btn-section">
    <button type="primary" class="start-btn" bindtap="startScoring" disabled="{{participants.length === 0}}">开始计分</button>
  </view>
  
  <!-- 新增参与者弹窗 -->
  <!-- 蒙层：禁止穿透滚动 -->
  <view class="modal-mask" wx:if="{{showAddModal}}" catchtouchmove="true">
    <view class="modal-panel">
      <view class="modal-title">添加参与者</view>

      <!-- 输入框：保持既有 bindinput/placeholder，不要改逻辑 -->
      <input class="modal-input"
             placeholder="请输入姓名"
             value="{{newName}}"
             bindinput="inputChange" />

      <view class="modal-actions">
        <button class="btn ghost" bindtap="cancelAdd">取消</button>
        <button class="btn primary" bindtap="confirmAdd">确认</button>
      </view>
    </view>
  </view>

  <!-- 调试用：无任何父级拦截，固定定位在右下角；上线前可删除 -->
  <button wx:if="{{canShare}}"
          class="share-debug"
          open-type="share">测试分享</button>
</view>

