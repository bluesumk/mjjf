<!-- æˆ‘çš„é¡µé¢ -->
<view class="container mine-container fade-in">
  <!-- ç”¨æˆ·ä¿¡æ¯å¡ç‰‡ -->
  <view class="user-card card">
    <view class="user-header">
      <view class="user-avatar-section">
        <view class="user-avatar">
          <text class="avatar-initial">{{nickname.charAt(0)}}</text>
        </view>
        <view class="user-badge">
          <text class="badge-text">ğŸ†</text>
        </view>
      </view>
      <view class="user-details">
        <text class="user-name title-large">{{nickname}}</text>
        <text class="user-title text-secondary">éº»å°†è®¡åˆ†è¾¾äºº</text>
      </view>
    </view>
    <view class="user-actions">
      <view class="profile-edit-section">
        <button class="avatar-btn" open-type="chooseAvatar" bindchooseavatar="onChooseAvatar" style="position: relative; left: -214rpx; top: -114rpx; width: 164rpx; display: flex; box-sizing: content-box; height: 45rpx">
          <text class="btn-icon">ğŸ“·</text>
          <text class="btn-text">æ›´æ¢å¤´åƒ</text>
        </button>
        <input style="width: 160rpx; display: block; box-sizing: border-box; height: 41rpx" 
          class="nickname-input" 
          type="nickname" 
          placeholder="ç‚¹å‡»è¾“å…¥æ˜µç§°" 
          value="{{nickname}}" 
          bindinput="onNicknameInput"
          bindblur="onNicknameBlur"
        />
      </view>
    </view>
  </view>

  <!-- æ—¶é—´ç­›é€‰å™¨ -->
  <view class="time-filter card">
    <view class="filter-title">
      <text class="title-medium">æ•°æ®ç»Ÿè®¡</text>
      <text class="filter-subtitle text-secondary">é€‰æ‹©æŸ¥çœ‹æ—¶é—´èŒƒå›´</text>
    </view>
    <view class="filter-controls">
      <picker mode="selector" range="{{yearList}}" value="{{yearList.indexOf(selectedYear)}}" bindchange="onYearChange">
        <view class="time-picker" style="width: 324rpx; display: flex; box-sizing: border-box">
          <text class="picker-label">å¹´ä»½</text>
          <view class="picker-value">
            <text class="value-text">{{selectedYear}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </view>
      </picker>
      <picker mode="selector" range="{{monthList}}" value="{{monthList.indexOf(selectedMonth)}}" bindchange="onMonthChange">
        <view class="time-picker" style="width: 329rpx; display: flex; box-sizing: border-box">
          <text class="picker-label">æœˆä»½</text>
          <view class="picker-value">
            <text class="value-text">{{selectedMonth}}</text>
            <text class="picker-arrow">â–¼</text>
          </view>
        </view>
      </picker>
    </view>
  </view>

  <!-- æ ¸å¿ƒæ•°æ®æ¦‚è§ˆ -->
  <view class="overview-card card">
    <view class="overview-header">
      <text class="section-title title-medium">æ ¸å¿ƒæ•°æ®</text>
      <text class="period-text text-secondary">{{selectedYear}}å¹´{{selectedMonth === 'å…¨éƒ¨' ? '' : selectedMonth}}</text>
    </view>
    <view class="metrics-grid">
      <view class="metric-item">
        <view class="metric-icon games-icon">ğŸ®</view>
        <text class="metric-value text-primary">{{personalSummary.totalGames}}</text>
        <text class="metric-label text-secondary">æ€»åœºæ•°</text>
      </view>
      <view class="metric-item">
        <view class="metric-icon win-icon">ğŸ†</view>
        <text class="metric-value text-success">{{personalSummary.totalWins}}</text>
        <text class="metric-label text-secondary">èƒœåœº</text>
      </view>
      <view class="metric-item">
        <view class="metric-icon rate-icon">ğŸ“Š</view>
        <text class="metric-value text-warning">{{personalSummary.winRate}}%</text>
        <text class="metric-label text-secondary">èƒœç‡</text>
      </view>
      <view class="metric-item">
        <view class="metric-icon score-icon">ğŸ’°</view>
        <text class="metric-value {{personalSummary.totalScore >= 0 ? 'text-success' : 'text-danger'}}">{{personalSummary.totalScore}}</text>
        <text class="metric-label text-secondary">æ€»å¾—åˆ†</text>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†ç»Ÿè®¡ -->
  <view class="detailed-stats card">
    <view class="stats-header">
      <text class="section-title title-medium">è¯¦ç»†ç»Ÿè®¡</text>
      <text class="expand-hint text-light">å±•å¼€æŸ¥çœ‹æ›´å¤šæ•°æ®</text>
    </view>
    
    <!-- è¯¦ç»†æ•°æ®ç½‘æ ¼ -->
    <view class="detailed-grid">
      <!-- åŸºç¡€æ•°æ®å¡ç‰‡ -->
      <view class="detail-card">
        <view class="detail-header">
          <text class="detail-title text-secondary">åŸºç¡€æ•°æ®</text>
        </view>
        <view class="detail-metrics">
          <view class="detail-metric">
            <text class="metric-value text-danger">{{personalSummary.totalLosses}}</text>
            <text class="metric-label text-light">æ€»è´Ÿåœº</text>
          </view>
          <view class="detail-metric">
            <text class="metric-value text-success">{{personalSummary.totalWinScore}}</text>
            <text class="metric-label text-light">æ€»èƒœåˆ†</text>
          </view>
          <view class="detail-metric">
            <text class="metric-value text-danger">{{personalSummary.totalLossScore}}</text>
            <text class="metric-label text-light">æ€»è´Ÿåˆ†</text>
          </view>
        </view>
      </view>

      <!-- å€ç‡æ•°æ®å¡ç‰‡ -->
      <view class="detail-card">
        <view class="detail-header">
          <text class="detail-title text-secondary">å€ç‡æ•°æ®</text>
        </view>
        <view class="detail-metrics">
          <view class="detail-metric">
            <text class="metric-value {{personalSummary.totalMultiplierScore >= 0 ? 'text-success' : 'text-danger'}}">{{personalSummary.totalMultiplierScore}}</text>
            <text class="metric-label text-light">å€ç‡æ€»åˆ†</text>
          </view>
          <view class="detail-metric">
            <text class="metric-value text-success">{{personalSummary.totalMultiplierWinScore}}</text>
            <text class="metric-label text-light">å€ç‡èƒœåˆ†</text>
          </view>
          <view class="detail-metric">
            <text class="metric-value text-danger">{{personalSummary.totalMultiplierLossScore}}</text>
            <text class="metric-label text-light">å€ç‡è´Ÿåˆ†</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¯¹æ‰‹ç»Ÿè®¡ -->
  <view class="opponent-stats card" wx:if="{{stats.length > 0}}">
    <view class="stats-header">
      <text class="section-title title-medium">å¯¹æ‰‹ç»Ÿè®¡</text>
      <text class="stats-subtitle text-secondary">ä¸å„ä½ç©å®¶çš„å¯¹æˆ˜è®°å½•</text>
    </view>
    <view class="opponent-list">
      <block wx:for="{{stats}}" wx:key="name">
        <view class="opponent-item">
          <view class="opponent-info">
            <view class="opponent-avatar">
              <text class="avatar-initial">{{item.name.charAt(0)}}</text>
            </view>
            <text class="opponent-name text-primary">{{item.name}}</text>
          </view>
          <view class="opponent-score">
            <text class="score-value {{item.cls}}">{{item.total >= 0 ? '+' : ''}}{{item.total}}</text>
            <text class="score-label text-light">æ€»åˆ†å·®</text>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-stats card" wx:else>
    <view class="empty-state">
      <text class="empty-icon">ğŸ“ˆ</text>
      <text class="empty-title">æš‚æ— ç»Ÿè®¡æ•°æ®</text>
      <text class="empty-desc">å¼€å§‹æ¸¸æˆåä¼šæ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡</text>
    </view>
  </view>
</view>