<!-- æˆ‘çš„é¡µé¢ -->
<view class="container mine-container fade-in">
  <!-- Profile Card -->
  <view class="profile-card" style="width: 708rpx; display: flex; box-sizing: border-box; position: relative; left: -24rpx; top: -43rpx">
    <view class="profile-left">
      <image class="avatar" src="{{avatarUrl || '/assets/avatar-placeholder.png'}}" mode="aspectFill" />
      <view class="meta">
        <text class="nickname">{{nickName || 'å¾®ä¿¡ç”¨æˆ·'}}</text>
        <text class="subtitle">éº»å°†è®¡åˆ†è¾¾äºº</text>
      </view>
    </view>
    <button class="btn-outline" bindtap="gotoEditProfile" style="width: 199rpx; display: block; box-sizing: border-box; left: 115rpx; top: -5rpx; position: relative">ä¿®æ”¹èµ„æ–™</button>
  </view>

  <!-- åŸ"æ•°æ®ç»Ÿè®¡"æ•´å—éšè— -->
  <view wx:if="{{false}}">
    <!-- åŸå…ˆçš„å¹´ä»½/æœˆé€‰æ‹©UIï¼Œä¿ç•™ä»¥ä¾¿å›æ»š -->
    <view class="time-filter card">
      <view class="filter-title">
        <text class="title-medium">æ•°æ®ç»Ÿè®¡</text>
        <text class="filter-subtitle text-secondary">é€‰æ‹©æŸ¥çœ‹æ—¶é—´èŒƒå›´</text>
      </view>
      <view class="filter-controls">
        <picker mode="selector" range="{{yearList}}" value="{{yearList.indexOf(selectedYear)}}" bindchange="onYearChange">
          <view class="time-picker" style="width: 324rpx; display: flex; box-sizing: border-box">
            <text class="picker-label">å¹´ä»½</text>
            <view class="picker-value">
              <text class="value-text">{{selectedYear}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </view>
        </picker>
        <picker mode="selector" range="{{monthList}}" value="{{monthList.indexOf(selectedMonth)}}" bindchange="onMonthChange">
          <view class="time-picker" style="width: 329rpx; display: flex; box-sizing: border-box">
            <text class="picker-label">æœˆä»½</text>
            <view class="picker-value">
              <text class="value-text">{{selectedMonth}}</text>
              <text class="picker-arrow">â–¼</text>
            </view>
          </view>
        </picker>
      </view>
    </view>
  </view>

  <!-- æ ¸å¿ƒæ•°æ® å¤´éƒ¨ + æ—¶é—´ç­›é€‰ -->
  <view class="overview-card card">
    <view class="section-header">
      <text class="title">æ ¸å¿ƒæ•°æ®</text>

      <view class="controls">
        <!-- æœˆä»½èƒ¶å›Šï¼šä½¿ç”¨ date picker fields=monthï¼Œç¨³å®šä¸æŠ–åŠ¨ -->
        <picker mode="date" fields="month" value="{{monthValue}}" bindchange="onMonthChange">
          <view class="pill">{{ monthLabel }}</view>
        </picker>

        <!-- å³ä¾§è½»æŒ‰é’®ï¼šæŒ‰å¹´ç»Ÿè®¡ / æŒ‰æœˆç»Ÿè®¡ï¼ˆåˆ‡æ¢ï¼‰ -->
        <button class="btn-ghost" bindtap="onToggleYearMode">
          {{ mode === 'year' ? 'æŒ‰æœˆç»Ÿè®¡' : 'æŒ‰å¹´ç»Ÿè®¡' }}
        </button>

        <!-- éšè—çš„å¹´ä»½é€‰æ‹©å™¨ï¼šä»…åœ¨è¿›å…¥ year æ¨¡å¼æ—¶å¼¹ä¸€æ¬¡ -->
        <picker wx:if="{{showYearPicker}}" mode="selector" range="{{yearOptions}}" value="{{yearIndex}}" bindchange="onYearPicked" bindcancel="onYearPickCancel">
          <view style="display:none;"></view>
        </picker>
      </view>
    </view>
    <view class="metrics-grid">
      <view class="metric-item">
        <view class="metric-icon games-icon">ğŸ®</view>
        <text class="metric-value text-primary">{{personalSummary.totalGames}}</text>
        <text class="metric-label text-secondary">æ€»åœºæ•°</text>
      </view>
      <view class="metric-item">
        <view class="metric-icon win-icon">ğŸ†</view>
        <text class="metric-value text-success">{{personalSummary.totalWins}}</text>
        <text class="metric-label text-secondary">èƒœåœº</text>
      </view>
      <view class="metric-item">
        <view class="metric-icon rate-icon">ğŸ“Š</view>
        <text class="metric-value text-warning">{{personalSummary.winRate}}%</text>
        <text class="metric-label text-secondary">èƒœç‡</text>
      </view>
      <view class="metric-item">
        <view class="metric-icon score-icon">ğŸ’°</view>
        <text class="metric-value {{personalSummary.totalScore >= 0 ? 'text-success' : 'text-danger'}}">{{personalSummary.totalScore}}</text>
        <text class="metric-label text-secondary">æ€»å¾—åˆ†</text>
      </view>
    </view>
  </view>

  <!-- è¯¦ç»†ç»Ÿè®¡ -->
  <view class="detailed-stats card">
    <view class="stats-header">
      <text class="section-title title-medium">è¯¦ç»†ç»Ÿè®¡</text>
      <text class="expand-hint text-light">å±•å¼€æŸ¥çœ‹æ›´å¤šæ•°æ®</text>
    </view>
    
    <!-- è¯¦ç»†æ•°æ®ç½‘æ ¼ -->
    <view class="detailed-grid">
      <!-- åŸºç¡€æ•°æ®å¡ç‰‡ -->
      <view class="detail-card">
        <view class="detail-header">
          <text class="detail-title text-secondary">åŸºç¡€æ•°æ®</text>
        </view>
        <view class="detail-metrics">
          <view class="detail-metric">
            <text class="metric-value text-danger">{{personalSummary.totalLosses}}</text>
            <text class="metric-label text-light">æ€»è´Ÿåœº</text>
          </view>
          <view class="detail-metric">
            <text class="metric-value text-success">{{personalSummary.totalWinScore}}</text>
            <text class="metric-label text-light">æ€»èƒœåˆ†</text>
          </view>
          <view class="detail-metric">
            <text class="metric-value text-danger">{{personalSummary.totalLossScore}}</text>
            <text class="metric-label text-light">æ€»è´Ÿåˆ†</text>
          </view>
        </view>
      </view>

      <!-- å€ç‡æ•°æ®å¡ç‰‡ -->
      <view class="detail-card">
        <view class="detail-header">
          <text class="detail-title text-secondary">å€ç‡æ•°æ®</text>
        </view>
        <view class="detail-metrics">
          <view class="detail-metric">
            <text class="metric-value {{personalSummary.totalMultiplierScore >= 0 ? 'text-success' : 'text-danger'}}">{{personalSummary.totalMultiplierScore}}</text>
            <text class="metric-label text-light">å€ç‡æ€»åˆ†</text>
          </view>
          <view class="detail-metric">
            <text class="metric-value text-success">{{personalSummary.totalMultiplierWinScore}}</text>
            <text class="metric-label text-light">å€ç‡èƒœåˆ†</text>
          </view>
          <view class="detail-metric">
            <text class="metric-value text-danger">{{personalSummary.totalMultiplierLossScore}}</text>
            <text class="metric-label text-light">å€ç‡è´Ÿåˆ†</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- å¯¹æ‰‹ç»Ÿè®¡ -->
  <view class="opponent-stats card" wx:if="{{stats.length > 0}}">
    <view class="stats-header">
      <text class="section-title title-medium">å¯¹æ‰‹ç»Ÿè®¡</text>
      <text class="stats-subtitle text-secondary">ä¸å„ä½ç©å®¶çš„å¯¹æˆ˜è®°å½•</text>
    </view>
    <view class="opponent-list">
      <block wx:for="{{stats}}" wx:key="name">
        <view class="opponent-item">
          <view class="opponent-info">
            <view class="opponent-avatar">
              <text class="avatar-initial">{{item.name.charAt(0)}}</text>
            </view>
            <text class="opponent-name text-primary">{{item.name}}</text>
          </view>
          <view class="opponent-score">
            <text class="score-value {{item.cls}}">{{item.total >= 0 ? '+' : ''}}{{item.total}}</text>
            <text class="score-label text-light">æ€»åˆ†å·®</text>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-stats card" wx:else>
    <view class="empty-state">
      <text class="empty-icon">ğŸ“ˆ</text>
      <text class="empty-title">æš‚æ— ç»Ÿè®¡æ•°æ®</text>
      <text class="empty-desc">å¼€å§‹æ¸¸æˆåä¼šæ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡</text>
    </view>
  </view>
</view>